<!-- Header -->
<div class="mb-6">
  <h1 class="text-2xl font-bold text-black mb-1"><%= @page_title %></h1>
  <p class="text-sm text-gray mb-4"><%= @posts.count %> topics</p>
  
  <!-- Compact Search -->
  <div class="max-w-sm">
    <%= form_with url: request.path, method: :get, local: true do |form| %>
      <%= form.text_field :search, 
            placeholder: "Search...", 
            value: params[:search],
            class: "w-full px-3 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:border-ruby" %>
      <%= form.hidden_field :category, value: params[:category] %>
    <% end %>
  </div>
</div>

<% if @post_type == "blog" %>
  <!-- Single Column Blog Layout -->
  <div class="max-w-2xl text-sm leading-tight">
    <% @posts.each do |post| %>
      <div class="flex items-start gap-3 py-2 border-b border-gray-100 last:border-b-0">
        <span class="text-xs text-gray mt-1 min-w-[4rem]">
          <%= post.created_at.strftime("%b %d, %y") %>
        </span>
        <div class="flex-1">
          <%= link_to blog_post_path(post.slug), class: "text-black hover:text-ruby transition-colors leading-snug" do %>
            <%= post.title %><% if post.ai_generated? %> <span class="text-xs text-gray-500">[AI]</span><% end %>
          <% end %>
          <% if post.description.present? %>
            <div class="text-gray text-xs mt-0.5 leading-relaxed">
              <%= post.description %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <!-- 2-Column Layout for Learn Ruby & Software Dev -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-sm leading-tight">
    <% @posts.group_by(&:category).each do |category, category_posts| %>
      <!-- Category -->
      <div class="mb-6">
        <h2 class="font-bold text-black mb-3 text-base border-b border-gray-200 pb-1">
          <%= category.present? ? category : "General" %>
          <span class="font-normal text-gray text-sm">(<%= category_posts.count %>)</span>
        </h2>
        
        <% if category_posts.any?(&:subcategory) %>
          <!-- With subcategories - Ruby style -->
          <% category_posts.group_by(&:subcategory).each do |subcategory, posts| %>
            <% if subcategory.present? %>
              <div class="mb-4">
                <h3 class="font-semibold text-black text-sm mb-2 text-gray-800"><%= subcategory %></h3>
                <div class="space-y-1">
                  <% posts.each do |post| %>
                    <% 
                      post_path = case @post_type
                      when "learn_ruby" then learn_ruby_post_path(post.slug)
                      when "software_dev" then software_dev_post_path(post.slug)
                      when "blog" then blog_post_path(post.slug)
                      end
                    %>
                    <div class="flex items-start gap-2">
                      <% if post.section_number.present? %>
                        <span class="text-xs text-gray font-mono min-w-[2.5rem] mt-0.5"><%= post.section_number %></span>
                      <% else %>
                        <span class="text-gray mt-1">•</span>
                      <% end %>
                      <%= link_to post_path, class: "text-black hover:text-ruby transition-colors flex-1 leading-snug" do %>
                        <%= post.title %><% if post.ai_generated? %> <span class="text-xs text-gray-500">[AI]</span><% end %>
                      <% end %>
                    </div>
                  <% end %>
                </div>
              </div>
            <% else %>
              <!-- No subcategory -->
              <div class="space-y-1">
                <% posts.each do |post| %>
                  <% 
                    post_path = case @post_type
                    when "learn_ruby" then learn_ruby_post_path(post.slug)
                    when "software_dev" then software_dev_post_path(post.slug)
                    when "blog" then blog_post_path(post.slug)
                    end
                  %>
                  <div class="flex items-start gap-2">
                    <span class="text-gray mt-1">•</span>
                    <%= link_to post_path, class: "text-black hover:text-ruby transition-colors flex-1 leading-snug" do %>
                      <%= post.title %><% if post.ai_generated? %> <span class="text-xs text-gray-500">[AI]</span><% end %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% end %>
          <% end %>
        <% else %>
          <!-- Flat list - Software Dev style -->
          <div class="space-y-1">
            <% category_posts.each do |post| %>
              <% 
                post_path = case @post_type
                when "learn_ruby" then learn_ruby_post_path(post.slug)
                when "software_dev" then software_dev_post_path(post.slug)
                when "blog" then blog_post_path(post.slug)
                end
              %>
              <div class="flex items-start gap-2">
                <span class="text-gray mt-1">•</span>
                <div class="flex-1">
                  <%= link_to post_path, class: "text-black hover:text-ruby transition-colors leading-snug" do %>
                    <%= post.title %><% if post.ai_generated? %> <span class="text-xs text-gray-500">[AI]</span><% end %>
                  <% end %>
                  <% if post.description.present? %>
                    <div class="text-gray text-xs mt-0.5 leading-relaxed">
                      <%= truncate(post.description, length: 80) %>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>

<!-- Minimal Empty State -->
<% if @posts.empty? %>
  <div class="text-sm text-gray">
    <% if params[:search].present? %>
      No results for "<%= params[:search] %>". 
      <%= link_to "Clear", request.path.split('?').first, class: "text-ruby hover:underline" %>
    <% else %>
      No topics available.
    <% end %>
  </div>
<% end %>
