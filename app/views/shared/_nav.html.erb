<div data-controller="drawer sign-in-modal" class="flex flex-col w-full">
  <!-- mobile header -->
  <header data-controller="header"
          class="fixed top-0 left-0 right-0 bg-white/90 backdrop-blur-sm
                 flex items-center p-4 z-40 shadow-md md:hidden">
    <button class="mr-4" data-action="click->drawer#toggle">
      <svg xmlns="http://www.w3.org/2000/svg"
           class="h-6 w-6 text-gray-900"
           fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round"
              d="M3.75 6.75h16.5M3.75 12h16.5M3.75 17.25h16.5"/>
      </svg>
    </button>
    <%= link_to root_path, class: "flex items-center gap-2" do %>
      <img src="/logo.png" alt="logo" class="h-6"/>
      <h1 class="text-lg font-bold">CrackedRuby</h1>
    <% end %>
  </header>

  <!-- backdrop when open on mobile -->
  <div data-drawer-target="backdrop" data-action="click->drawer#close"
       class="fixed inset-0 bg-black/20 z-40 hidden md:hidden"></div>

  <!-- sidebar nav -->
  <nav id="nav" data-drawer-target="panel"
       class="fixed inset-y-0 left-0 w-56 bg-white border-r border-gray-200
              text-gray-800 transform -translate-x-full md:translate-x-0
              transition-transform duration-200 ease-in-out z-50 flex flex-col overflow-y-auto">

    <!-- close button on mobile -->
    <button type="button"
            data-action="click->drawer#close"
            data-drawer-target="closeButton"
            class="fixed top-4 left-56 transform translate-x-1/4
                   w-7 h-7 flex items-center justify-center
                   bg-white rounded-full shadow
                   text-gray-500 hover:text-gray-800 hover:bg-gray-100
                   md:hidden z-50">
      âœ•
    </button>

    <div class="flex-1 overflow-y-auto p-4 flex flex-col">
      <!-- logo link -->
      <div class="mb-6">
        <%= link_to root_path, class: "flex items-center gap-2" do %>
          <img src="/logo.png" alt="logo" class="h-7"/>
          <h2 class="text-xl font-bold">CrackedRuby</h2>
        <% end %>
      </div>

      <!-- dynamic sections -->
      <div class="flex flex-col space-y-4 mb-6">
        <% [
          ["Learn Ruby",   lessons_path,  Lesson],
          ["Software Dev", articles_path, Article],
          ["Blog",         posts_path,    Post]
        ].each do |label, index_path, model| %>
          <details open class="group">
            <summary class="flex justify-between items-center font-semibold
                              text-gray-800 hover:text-red-600 cursor-pointer">
              <%= label %>
              <svg xmlns="http://www.w3.org/2000/svg"
                   class="h-4 w-4 text-gray-400 group-open:hidden"
                   fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M9 5l7 7-7 7"/>
              </svg>
              <svg xmlns="http://www.w3.org/2000/svg"
                   class="h-4 w-4 text-gray-400 hidden group-open:inline"
                   fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M19 9l-7 7-7-7"/>
              </svg>
            </summary>

            <ul class="ml-4 mt-1 space-y-1">
              <% model.where(featured: true).limit(3).each do |item| %>
                <li>
                  <%= link_to item.title,
                              polymorphic_path(item),
                              class: "block text-gray-600 hover:text-red-600 text-sm truncate" %>
                </li>
              <% end %>
              <li>
                <%= link_to "View All", index_path,
                            class: "block text-sm text-gray-600 hover:text-red-600 underline" %>
              </li>
            </ul>
          </details>
        <% end %>

        <%= link_to "About", about_path,
                    class: "font-semibold text-gray-800 hover:text-red-600" %>
      </div>

      <!-- sign in / user -->
      <div class="mt-auto mb-6">
        <% if user_signed_in? %>
          <%= render "shared/user_dropdown" %>
        <% else %>
          <button data-action="click->sign-in-modal#open"
                  class="w-full py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">
            Sign In
          </button>
        <% end %>
      </div>
    </div>
  </nav>
  <%= render "shared/sign_in_modal" %>
</div>
